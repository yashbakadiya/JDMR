{% extends 'dashboard/base.html' %}
{% load static %}
{% block css %}
@import url('https://fonts.googleapis.com/css?family=Numans');
<style media="screen">
	.container {
		align-content: center;
	}

	.card {
		margin-top: auto;
		margin-bottom: auto;
		width: 800px;
		background-color: white;
	}

	.card-header h3 {
		color: white;
	}

	input:focus {
		outline: 0 0 0 0 !important;
		box-shadow: 0 0 0 0 !important;

	}

	.remember {
		color: white;
	}

	.remember input {
		width: 19px;
		height: 19px;
		margin-left: 15px;
		margin-right: 5px;
	}

	.links {
		color: white;
	}

	.links a {
		margin-left: 4px;
	}

	.control-label {
		color: rgb(66, 8, 8);
		font-size: 20px;
	}

	.multiselect-container>li>a>label {
		height: auto;
	}

	.multiselect-container {
		height: 10rem;
		overflow-y: scroll;
		width: max-content;
	}
</style>
{% endblock %}
{% block main-content %}
<div class="mt-5">
	{% if messages %}
    {% for k in messages%}
    <div class="alert alert-{{k.tags}} alert-dismissible fade show" role="alert">
        <b>{{ k }} !</b>
        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
    {% endfor %}
    {% endif %}
	<div class="card">
		<div class="card-header">
			<div class="row">
				<div class="col-sm">
					<h2 style="color: rgb(66, 8, 8);">Edit Tutor Instance</h2>
				</div>
			</div>
		</div>
		<div class="card-body container">
			<form id='submitForm' method='post' action=''>{% csrf_token %}
				<div id='mainForm' class="container">
					<hr>
					<div id='basicData' name='basicData' class="row">
						<div class="input-group form-group">
							<label class="control-label mt-2 col-sm-4">Username</label>
							<input type="text" class="form-control col-sm-8" id="username " name='NewUsername'
								placeholder="Username" readonly required value="{{ tutorBaseData.user.username }}"><br><br>
						</div>
						<div class="input-group form-group">
							<label class="control-label mt-2 col-sm-4">Email-Id</label>
							<input type="email" class="form-control col-sm-8" id="email" name='NewEmail'
								placeholder="Email Address" readonly required value="{{ tutorBaseData.user.email }}"><br><br>
						</div>
						<div class="input-group form-group">
							<label class="control-label mt-2 col-sm-4">Phone Number<span class="text-danger">*</span></label>
							<input type="number" class="form-control col-sm-8" id="phone" name='NewPhone'
								placeholder="Phone Number" required value="{{ tutorBaseData.phone }}"
								type="number"><br><br>
						</div>
					</div>
					<hr>
					<div class="outside">
						<div class="row entry">
							<div class="col-sm-3">
								<div class="form-group">
									<label  class="control-label" for="cn">Class Name</label>
									<div>
										<select name="cn" class="cn custom-select form-control" required="required" onchange="selectclass(this)">
											{% if editTutor.forclass %}
											<option disabled selected value="{{editTutor.forclass}}">{{editTutor.forclass}}</option>
											{% else %}
											<option disabled selected value="">Select an option</option>
											{% endif %}
											{% for x in data %}
											<option value="{{ x.0 }}">{{ x.0 }}</option>
											{% endfor %}
										</select>
									</div>
								</div>
							</div>
							<div class="col-sm-3">
								<div class="form-group">
									<label class="control-label" for="ctn">Course Taught</label>
									<div>
										<select name="ctn" class="ctn custom-select form-control" required="required" onclick="selectcourse(this)">
											{% if editTutor.courseName %}
											<option disabled selected value="{{editTutor.courseName}}">{{editTutor.courseName}}</option>
											{% else %}
											<option disabled selected value="">Select an option</option>
											{% endif %}
										</select>
									</div>
								</div>
							</div>
							<div class="col-sm-4">
								<div class="form-group">
									<label class="control-label" for="ttn">Teaching Type</label>
									<div>
										<select name="ttn" class="ttn custom-select form-control" required="required">
											{% if editTutor.teachType %}
											<option disabled selected value="{{editTutor.teachType}}">{{editTutor.teachType}}</option>
											{% else %}
											<option disabled selected value="">Select an option</option>
											{% endif %}
										</select>
									</div>
								</div>
							</div>
							<div class="col-sm-2 form-inline" style="display: flex;align-items: center;">
								<div class="form-group">
									<button class="btn btn-warning btn-md float-right" type="button" onclick="duplicate(this)">Add New</button>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="row container">
					<div class="form-group col-sm-6 sm-ml-1">
						Availability:
						<select id="availability" name="availability" class="custom-select form-control"
							required="required">
							<option value="weekly" selected>weekly</option>
							<option value="weekend" selected>weekend</option>
							<option value="both" selected>both</option>
						</select>
					</div>
				</div>
				<div class="row container">
					<div class="col-sm-4 sm-ml-1">
						<button id='submitBtn' name="submit" type="submit" class="btn btn-primary">Submit</button>
					</div>
				</div>
			</form>
		</div>
	</div>

</div>
<script>
	// var counter = 1;
	// var Dclone = document.querySelector('#entry1').cloneNode(true);
	// function emptyit(ele) {
	// 	while (ele.length > 0) {
	// 		ele.remove(0);
	// 	}
	// }
	// function duplicate(data) {
	// 	var f = document.getElementById('submitForm');
	// 	if (!f.checkValidity()) {
	// 		f.reportValidity();
	// 	}
	// 	else {
	// 		var disParent = data.parentElement.parentElement.parentElement;
	// 		var ctn = disParent.children[0].children[0].children[1].children[0];
	// 		var cn = disParent.children[1].children[0].children[1].children[0];
	// 		var ttn = disParent.children[2].children[0].children[1].children[0];
	// 		ctn.disabled = true;
	// 		cn.disabled = true;
	// 		ttn.disabled = true;
	// 		data.disabled = true;
	// 		var removeCTN = document.getElementsByName("ctn")
	// 		var removeOptions = [];
	// 		for (var x = 0; x < removeCTN.length; x++) {
	// 			removeOptions.push(removeCTN[x].value);
	// 		}
	// 		var clone = Dclone.cloneNode(true);
	// 		counter += 1;
	// 		clone.setAttribute('id', 'entry' + counter);
	// 		var ctnNode = clone.children[0].children[0].children[1].children[0];
	// 		var cnNode = clone.children[1].children[0].children[1].children[0];
	// 		var ttnNode = clone.children[2].children[0].children[1].children[0];
	// 		$(cn).multiselect('disable');
	// 		$(ttn).multiselect('disable');
	// 		$(cnNode).multiselect();
	// 		$(ttnNode).multiselect();
	// 		var oldData = [];
	// 		for (var x = 1; x < ctnNode.length; x++) {
	// 			oldData.push(ctnNode[x].value)
	// 		}
	// 		emptyit(ctnNode);
	// 		for (var x in oldData) {
	// 			if (!removeOptions.includes(oldData[x])) {
	// 				addoption(ctnNode, oldData[x]);
	// 			}
	// 		}
	// 		document.querySelector('#mainForm').appendChild(clone)
	// 	}
	// }
	// function addoption(ele, val) {
	// 	var opt = document.createElement('option');
	// 	opt.value = val;
	// 	opt.innerHTML = val;
	// 	ele.appendChild(opt);
	// }
	// function addoptions(ele, ar) {
	// 	for (var x in ar) {
	// 		addoption(ele, ar[x]);
	// 	}
	// }
	// function addvals(data) {
	// 	var mainParentNode = data.parentElement.parentElement.parentElement.parentElement;
	// 	var cn = mainParentNode.children[1].children[0].children[1].children[0];
	// 	var ttn = mainParentNode.children[2].children[0].children[1].children[0];
	// 	var currentval = data.value;
	// 	var alldata = JSON.parse("{{jsdata|escapejs}}");
	// 	emptyit(cn);
	// 	emptyit(ttn);
	// 	addoptions(cn, alldata[currentval][0])
	// 	addoptions(ttn, alldata[currentval][1])
	// 	// htm0 = "";
	// 	// htm1 = "";
	// 	// for(i=0;i<alldata[currentval][0].length;i++){
	// 	// 	htm0 += "<option value='" + alldata[currentval][0][i] + "'>"+alldata[currentval][0][i]+"</option>";
	// 	// 	htm1 += "<option value='" + alldata[currentval][1][i] + "'>"+alldata[currentval][1][i]+"</option>";
	// 	// 	$("#cn").append(htm0);
	// 	// 	$("#ttn").append(htm1);
	// 	// 	console.log(i);
	// 	// }
	// 	$(cn).multiselect("rebuild");
	// 	$(ttn).multiselect("rebuild");

	// 	var saveVal = mainParentNode.children[5]
	// 	saveVal.value = data.value;
	// 	console.log(saveVal.value)
	// }
	// function cnCombine(data) {
	// 	var mainParentNode = data.parentElement.parentElement.parentElement.parentElement;
	// 	var cn = mainParentNode.children[3];
	// 	var result = [];
	// 	var options = data && data.options;
	// 	var opt;
	// 	for (var i = 0, iLen = options.length; i < iLen; i++) {
	// 		opt = options[i];
	// 		if (opt.selected) {
	// 			result.push(opt.value || opt.text);
	// 		}
	// 	}
	// 	cn.value = result.join(', ');
	// }
	// function ttnCombine(data) {
	// 	var mainParentNode = data.parentElement.parentElement.parentElement.parentElement;
	// 	var ttn = mainParentNode.children[4];
	// 	var result = [];
	// 	var options = data && data.options;
	// 	var opt;
	// 	for (var i = 0, iLen = options.length; i < iLen; i++) {
	// 		opt = options[i];
	// 		if (opt.selected) {
	// 			result.push(opt.value || opt.text);
	// 		}
	// 	}
	// 	ttn.value = result.join('\n');
	// }
	// $("#cn").multiselect();
	// $("#ttn").multiselect();
	function selectclass(el) {
    var selected = el.value;
    $.ajax({
      url: "{% url 'findCourse' %}",
      data: {
        forclass: selected,
      },
      success: function (data) {
        courses = data.courses;
        $(el).closest(".entry").find(".ctn").empty().trigger("change");
        for (i = 0; i < courses.length; i++) {
          var newOption = new Option(
            courses[i][1],
            courses[i][1],
            false,
            false
          );
          $(el).closest(".entry").find(".ctn").append(newOption).trigger("change");
        }
      },
    });
  }

  function selectcourse(el) {
      var selected_course = el.value;
    var selected_class = $(el).closest(".entry").find(".cn").val();
    $.ajax({
      url: "{% url 'findTeaching' %}",
      data: {
        forclass: selected_class,
        course: selected_course
      },
      success: function (data) {
        teaching = data.teaching;
        $(el).closest(".entry").find(".ttn").empty().trigger("change");
        for (i = 0; i < teaching.length; i++) {
          var newOption = new Option(
            teaching[i][0],
            teaching[i][0],
            false,
            false
          );
          $(el).closest(".entry").find(".ttn").append(newOption).trigger("change");
        }
      },
    });
  }

  function duplicate(){
      $('.outside').append(`<div class="row entry">
                            <div class="col-sm-3">
                            <div class="form-group">
                                <label  class="control-label" for="cn">Class Name</label>
                                <div>
                                    <select name="cn" class="cn custom-select form-control" required="required" onchange="selectclass(this)">
                                        <option disabled selected value="">Select an option</option>
                                        {% for x in data %}
                                        <option value="{{ x.0 }}">{{ x.0 }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-3">
                            <div class="form-group">
                                <label class="control-label" for="ctn">Course Taught</label>
                                <div>
                                    <select name="ctn" class="ctn custom-select form-control" required="required" onclick="selectcourse(this)">
                                        <option disabled selected value="">Select an option</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-4">
                            <div class="form-group">
                                <label class="control-label" for="ttn">Teaching Type</label>
                                <div>
                                    <select name="ttn" class="ttn custom-select form-control" required="required">
                                        <option disabled selected value="">Select an option</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        </div>`)
  }
</script>
{% endblock %}