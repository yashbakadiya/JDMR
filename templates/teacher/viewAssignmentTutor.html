{% extends 'dashboard/Tutor-dashboard.html' %}
{% load static %}
{% load humanize %}
{% block extra-stylesheets %}

<!-- CDN for google maps Place API -->
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCBJybI10-Xa43-F5GSad1i0Y9W3yqlW6Q&libraries=places&v=3"
  defer></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

{% endblock extra-stylesheets %}
{% block main-content %}
<div class="mt-5 row">
  <div class="col-lg-12">
    <div class="card statbox widget box box-shadow">
      <div class="card-header border-bottom border-default">
        <div class="row">
          <div class="col-xl-12 col-md-12 col-sm-12 col-12">
            <h2 style="color:black;">Search Assignments</h2>
          </div>
        </div>
      </div>
      <div class="widget-content widget-content-area">
        <div class="row">
          <div class="col-lg-12 col-md-12 cms-search">
            <form class="form-inline mt-2 mb-5" method="POST">
              {% csrf_token %}
              <div class="col-lg-5 col-md-6 col-12 mt-2 row">
                <label class="control-label col-sm-3 col-5 mt-3" style="display: block; color:black;">Location</label>
                <input type="text" class="form-control my-2 w-100 col-sm-8 col-7" id="pac-input" name='loc'
                  placeholder="Enter Location" required value="{{prefill.address}}">
                <input type="hidden" id="cityLat" value="0" name="cityLat" />
                <input type="hidden" id="cityLng" value="0" name="cityLng" />
              </div>
              <div class="col-lg-5 col-md-6 col-12 mt-2 row">
                <label class="control-label col-sm-3 col-5 mt-3" style="display: block; color:black;">Budget</label>
                <input type="number" class="form-control my-2 w-100 col-sm-8 col-7"
                  style="-moz-appearance: textfield;" min="0" name="budget" value="{{prefill.budget}}"
                  placeholder="Budget">
              </div>
              <div class="col-lg-5 col-md-6  col-12 mt-2 row">
                <label class="control-label col-sm-3 col-5 mt-3" style="display: block; color:black;">Class</label>
                <select id="className" name="className" class="custom-select form-control w-100 col-sm-8 col-7"
                  onchange="subjects()">
                </select>
              </div>
              <div class="col-lg-5 col-md-6  col-12 mt-2 row">
                <label class="control-label col-sm-3 mt-3 col-5" style="display: block; color:black;">Subject</label>
                <select id="subject" name="subject" class="custom-select form-control w-100 col-sm-8 col-7"
                  placeholder="Subject">
                  {% if prefill.subject %}
                  <option disabled selected value="{{prefill.subject}}">{{prefill.subject}}</option>
                  {% else %}
                  <option disabled selected value="">Subject</option>
                  {% endif %}
                </select>
              </div>
              <div class="col-lg-2 col-md-2 col-12 mt-2 d-flex justify-content-end">
                <button class="btn btn-info">Search</button>
                </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% if allData %}
<div class="widget-content widget-content-area mt-4">
  <div class="table-responsive">
    <table id="htmlgrid" class="testgrid table table-striped table-bordered table-hover mb-4">
      <tr>
        <th>#</th>
        <th>Student</th>
        <th>Course</th>
        <th>Class</th>
        <th>Requirement</th>
        <th>Phone</th>
        <th>Created</th>
        <th>Budget</th>
        <th class="text-center">View</th>
      </tr>
      {% for assing in allData reversed %}
      <tr>
        <td>{{forloop.counter}}</td>
        <td>{{assing.student.user.first_name}} {{assing.student.user.last_name}}</td>
        <td>{{assing.courseName}}</td>
        <td>{{assing.forclass}}</td>
        <td>{{assing.requirement}}</td>
        <td>{{assing.student.phone}}</td>
        <td>{{assing.timestamp|naturaltime}}</td>
        <td>{{assing.budget}}</td>
        <td class="text-center">
          <a href="{{assing.descriptionFile.url}}" class="btn btn-info" target="_blank">View</a>
        </td>
      </tr>
      {% endfor %}
    </table>
  </div>
</div>
{% endif %}
</div>
<script>
  console.log("this is js")
  var className = document.getElementById("className")
  var jsondata = {{ jsonLocalData| safe}}
  var prefillclass = "{{prefill.class}}"
  const keys = Object.keys(jsondata);

  if (prefillclass) {
    var classes = `<option disabled selected value="${prefillclass}">${prefillclass}</option>`
  }
  else {
    var classes = `<option disabled selected value="">Class</option>`
  }
  for (let index = 0; index < keys.length; index++) {
    const element = keys[index];
    classes += `<option value="${element}">${element}</option>`
  }
  className.innerHTML = classes

  function subjects() {
    var className = document.getElementById("className").value
    var subject = document.getElementById("subject")
    var html=''
    class_subjects = jsondata[`${className}`]
    for (let index = 0; index < class_subjects.length; index++) {
      const element = class_subjects[index];
      html += `<option value="${element}">${element}</option>`
    }
    subject.innerHTML = html
  }
</script>
<script type="text/javascript">
  $("#pac-input").on("input", function () {
    var input = document.getElementById('pac-input');
    var autocomplete = new google.maps.places.Autocomplete(input);
    google.maps.event.addListener(autocomplete, 'place_changed', function () {
      var place = autocomplete.getPlace();
      document.getElementById('cityLat').value = place.geometry.location.lat();
      document.getElementById('cityLng').value = place.geometry.location.lng();
    });
  });
</script>
{% endblock main-content %}